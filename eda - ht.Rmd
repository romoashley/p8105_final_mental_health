---
title: "eda"
author: "hsin yi tseng"
output: html_document
---

### Setting Up 

```{r setup, include=FALSE}
library(tidyverse)
library(ggridges)
library(patchwork)

library(modelr)
library(purrr)
library(broom)
library(dplyr)


knitr::opts_chunk$set(
	echo = TRUE,
	warning = FALSE,
	fig.width = 8, 
  fig.height = 6,
  out.width = "90%"
)

theme_set(theme_minimal() + theme(legend.position = "bottom"))

options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```

## Loading the dataset

```{r message = FALSE}
 tidy = 
  read.csv("data/tidydata.csv") |>
  mutate(
    start_dates = as.Date(start_dates))
```

Differences in indicator variables by age group and education level

## Age group

I started with filtering the tidy dataset to only with age and reside in the United States. Then, I renamed the "80 years and above" subgroup to 80+ years. Afterward, I plotted the age group. 

```{r}
#Filtering the dataset to age and united states
age_plot <- tidy |> 
  filter(group == "Age", state == "United States")

#Renaming the "80 years and above" subgroup to 80+ years
age_plot$subgroup[age_plot$subgroup == "80 years and above"] = "80+ years"

#Ploting the age group
age_plot |> 
  group_by(indicator, week_number, subgroup) |>
  ggplot(aes(x = week_number, y = value, color = indicator)) +
  geom_line() +
  facet_grid(. ~ subgroup) +
  labs(
    x = "WeeK Number",
    y = "Average Value",
    title = "Differences in Indicators Among Age Groups (2020-2022)") +
  theme_gray() +
  theme(legend.position = "bottom")

age_plot
```

## Education level 

I began with filtering the tidy dataset to only with age and reside in the United States. In the next step, I relevel the education subgroup by create a new variable, ed_name. Afterward, I used the new variable, ed_name to created a education plot.  

```{r}
#Filtering the dataset to age and united states, relevel the subgroup, and plot the education plot 
ed_plot= 
  tidy |>
  filter(group == "Education", state == "United States") |> 
   mutate(ed_name = forcats::fct_relevel(subgroup, c("Bachelor's degree or higher",
                                                     "Some college/Associate's degree", "High school diploma or GED", "Less than a high school diploma"))) |> 
  group_by(start_dates, ed_name, indicator) |> 
  ggplot(aes(x = week_number, y = value, color = indicator)) +
  geom_line() +
  facet_grid(. ~ ed_name) +
  labs(
    x = "WeeK Number",
    y = "Average Value",
    title = "Differences in Indicators by Education Levels (2020-2022)") +
  theme_gray() +
  theme(legend.position = "bottom")

ed_plot
```

