---
title: "Statistical Analysis"
author: "Sarah Younes"
date: "2023-11-30"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r message = FALSE}
library(tidyverse)

tidydata = 
  read.csv("data/tidydata.csv")
```

Focus on two indicators:

1. "Took Prescription Medication for Mental Health And/Or Received Counseling or Therapy"
2. "Needed Counseling or Therapy But Did Not Get It"

## Independent samples t-tests: gender

### Took prescription medication for mental health and/or received counseling or therapy

```{r}
gender_received =
  tidydata |>
  filter(
    indicator == "Took Prescription Medication for Mental Health And/Or Received Counseling or Therapy",
    state == "United States",
    group == "Sex",
    subgroup %in% c("Male", "Female")
  ) |>
  select(week_number, value, subgroup) |>
  pivot_wider(
    names_from = "subgroup",
    values_from = "value") |>
  janitor::clean_names()

gender_received |>
  summarise(
    t_statistic = t.test(male, female)$statistic,
    p_value = t.test(male, female)$p.value)
```

### Needed counseling or therapy but did not get it

```{r}
gender_needed =
  tidydata |>
  filter(
    indicator == "Needed Counseling or Therapy But Did Not Get It",
    state == "United States",
    group == "Sex",
    subgroup %in% c("Male", "Female")
  ) |>
  select(week_number, value, subgroup) |>
  pivot_wider(
    names_from = "subgroup",
    values_from = "value") |>
  janitor::clean_names()

gender_needed |>
  summarise(
    t_statistic = t.test(male, female)$statistic,
    p_value = t.test(male, female)$p.value)
```

## ANOVA: sexual orientation

```{r}
sexuality_received =
  tidydata |>
  filter(
    indicator == "Took Prescription Medication for Mental Health And/Or Received Counseling or Therapy",
    state == "United States",
    group == "Sexual orientation",
    week_number %in% c(24:33)) |>
  select(week_number, value, subgroup) |>
  pivot_wider(
    names_from = "subgroup",
    values_from = "value") |>
  janitor::clean_names()
```

```{r}
sexuality_needed =
  tidydata |>
  filter(
    indicator == "Needed Counseling or Therapy But Did Not Get It",
    state == "United States",
    group == "Sexual orientation",
    week_number %in% c(24:33)) |>
  select(week_number, value, subgroup) |>
  pivot_wider(
    names_from = "subgroup",
    values_from = "value") |>
  janitor::clean_names()
```



#Check normality 
```{r}

ggplot(tidydata, aes(sample = value)) +
  stat_qq() +
  stat_qq_line()

 hist(tidydata$value, breaks = "FD", main = "Histogram of Data", xlab = "Data Values")
```
The plot appears to be a Q-Q (quantile-quantile) plot showing that the data deviates from the expected normal distribution, particularly in the tails, indicating the presence of outliers or a heavy-tailed distribution.

The histogram illustrates a bimodal frequency distribution of data values, with significant concentrations of observations around two central peaks, suggesting the presence of two subpopulations within the dataset. The data range from near 0 to just over 60, with the majority of values clustered between 5 and 30, and a notable right skew indicating a tail of higher values extending towards 60. This skewness and the thinning bars towards the right may also point to the existence of outliers or extreme values in the dataset. The bimodal nature and the distribution's spread underscore the potential complexity within the data, hinting at varied underlying characteristics or groups.



```{r}
ggplot(tidydata, aes(sample = log(value))) +
  stat_qq() +
  stat_qq_line()

 hist(log(tidydata$value), breaks = "FD", main = "Histogram of Data", xlab = "Data Values")
```
Despite the application of a logarithmic transformation to the data, the resulting distribution does not conform to normality. This is evidenced by the Q-Q plot, which exhibits significant deviations from the line of normality, particularly in the tails. Such persistent non-normality suggests that the underlying data may not be log-normally distributed, or there may be influential outliers that resist transformation. Alternative transformations or non-parametric methods may be required to address these distributional issues.


```{r}
tidydata=tidydata |> mutate(subgroup=as.factor(subgroup),group=as.factor(group))
summary(pull(tidydata, value))
```
The summary statistics for the value dataset indicate a right-skewed distribution: the minimum value is 1.40, the first quartile is 10.30, the median is 16.20, and the third quartile is 24.00, with a considerably higher maximum value of 62.90. The mean, or average, is 17.45, which is higher than the median, further suggesting a distribution with a right tail. The broad range from the minimum to the maximum value points to a wide variation in the data, and the displacement of the mean towards the higher end of the range hints at the presence of outliers or a long tail to the right of the median.

#Kruskal-Wallis test

```{r}

kruskal_result=kruskal.test(value ~ subgroup, data = tidydata)
```

Kruskal-Wallis Chi-squared=1680.6. This is the test statistic that follows a chi-squared distribution under the null hypothesis. A value of 1680.6 is quite large, suggesting a significant difference.

The p-value is less than 2.2e-16, which is a commonly used threshold to denote a p-value smaller than can be represented in R's default numerical precision. It effectively means that the p-value is extremely small, much less than the commonly used significance levels (like 0.05 or 0.01), indicating that there is a statistically significant difference in the medians across the groups.

In summary, the test result is highly significant, which leads to the rejection of the null hypothesis of equal medians. Therefore, we have sufficient evidence to say that not all group medians are equal.